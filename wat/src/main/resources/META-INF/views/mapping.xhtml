<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="/templates/mainLayout.xhtml">
    <ui:define name="moduleHeader">
        <h:outputStylesheet library="css" name="mapping.css" />
        <h:outputStylesheet library="css/primeui" name="primeui-0.9.6.css" />
        <script data-main="#{request.contextPath}/javax.faces.resource/taitale.js.jsf?ln=js" src="#{request.contextPath}/javax.faces.resource/require/require.js.jsf?ln=js" type="text/javascript" charset="utf-8"/>
    </ui:define>
    <ui:define name="moduleContent">
        <p:layout widgetVar="mappingLW">
            <!--
            <p:layoutUnit id="mappingOuput" position="east" size="400" header="Mapping focus" resizable="true" collapsible="true" effect="fade" collapsed="true">
                <h:outputText value="Layout for map object output (definition, monitoring ...)" /> <br/>
                <p:commandButton value="Toggle" onclick="mappingLW.toggle('east')"/>
            </p:layoutUnit>
            -->
            <p:layoutUnit position="center" resizable="false">
                <p:layout id="mappingLayout">
                    <p:layoutUnit position="north" size="210" header="Mapping tools" resizable="false" collapsible="true">
                        <p:tabView id="mappingToolsView" activeIndex="1">
                            <!--
                            <p:tab id="mappingToolsExportTab" title="Export">
                                <p:graphicImage value="#{request.contextPath}/javax.faces.resource/export/csv.png.jsf?ln=images" />
                                <p:graphicImage value="#{request.contextPath}/javax.faces.resource/export/excel.png.jsf?ln=images" />
                                <p:graphicImage value="#{request.contextPath}/javax.faces.resource/export/pdf.png.jsf?ln=images" />
                                <p:graphicImage value="#{request.contextPath}/javax.faces.resource/export/xml.png.jsf?ln=images" />
                            </p:tab>
                            -->
                            <p:tab id="mapToolsDisplayTab" title="Options">
                                <h:panelGrid columns="4" cellpadding="5">
                                    <h:panelGroup>
                                        <span class="inputTitle">View</span><br/>
                                        <p:selectOneButton id="viewSelector" value="#{userProfileController.sessionPreferences['mappingDisplayView']}">
                                            <f:selectItem itemLabel="Component" itemValue="Component"/>
                                            <f:selectItem itemLabel="Cluster" itemValue="Cluster" />
                                            <f:selectItem itemLabel="Application" itemValue="Application" />
                                        </p:selectOneButton>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <span class="inputTitle">Layout</span><br/>
                                        <p:selectOneButton id="layoutSelector" widgetVar="layoutSelector" value="#{userProfileController.sessionPreferences['mappingDisplayLayout']}">
                                            <f:selectItem itemLabel="Tree" itemValue="Tree" />
                                            <f:selectItem itemLabel="Network" itemValue="Network" />
                                        </p:selectOneButton>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <span class="inputTitle">Mode</span>
                                        <p:selectOneButton id="modeSelector" widgetVar="modeSelector" value="#{userProfileController.sessionPreferences['mappingDisplayMode']}">
                                            <f:selectItem itemLabel="Navigation" itemValue="Navigation"/>
                                            <f:selectItem itemLabel="Edition" itemValue="Edition" />
                                        </p:selectOneButton>
                                    </h:panelGroup>
                                    <h:panelGroup>
                                        <span class="inputTitle">Notifications options</span>
                                        <p:selectManyButton id="notificationsOptions" widgetVar="notificationsOptions" value="#{notificationsController.defaultNotifications}">
                                            <f:selectItem itemLabel="Notify infos" itemValue="notifyInfos" />
                                            <f:selectItem itemLabel="Notify warnings" itemValue="notifyWarns" />
                                            <f:selectItem itemLabel="Notify errors" itemValue="notifyErrs" />
                                        </p:selectManyButton>
                                    </h:panelGroup>
                                </h:panelGrid>
                                <div id="networkOptions">
                                    <h:panelGrid columns="2" cellpadding="5">
                                        <h:panelGroup>
                                            <span class="inputTitle">Display options</span>
                                            <p:selectManyButton id="networkLayoutDisplayOptions" widgetVar="networkLayoutDisplayOptions">
                                                <f:selectItem itemLabel="Display datacenters" itemValue="displayDC" />
                                                <f:selectItem itemLabel="Display areas" itemValue="displayArea" />
                                                <f:selectItem itemLabel="Display subnets" itemValue="displayLan" />
                                            </p:selectManyButton>
                                        </h:panelGroup>
                                    </h:panelGrid>
                                </div>
                                <div id="treeOptions">
                                    <h:panelGrid columns="2" cellpadding="5">
                                        <h:panelGroup>
                                            <span class="inputTitle">Root tree sorting</span>
                                            <p:selectOneButton id="rootTreeSorting" widgetVar="rootTreeSorting">
                                                <f:selectItem itemLabel="By maximum vertex linked" itemValue="1" />
                                                <f:selectItem itemLabel="By minimum vertex linked" itemValue="-1" />
                                            </p:selectOneButton>
                                        </h:panelGroup>
                                        <h:panelGroup>
                                            <span class="inputTitle">Sub trees sorting</span>
                                            <p:selectOneButton id="subTreesSorting" widgetVar="subTreesSorting">
                                                <f:selectItem itemLabel="By maximum vertex linked" itemValue="1" />
                                                <f:selectItem itemLabel="By minimum vertex linked" itemValue="-1" />
                                            </p:selectOneButton>
                                        </h:panelGroup>
                                    </h:panelGrid>
                                </div>
                            </p:tab>
                            <p:tab id="mapToolsQueryTab" title="Query" >
                                <h:form id="mapToolsQueryForm">
                                    <h:panelGrid id="mapToolsQueryGrid" columns="2" cellpadding="5">
                                        <!--<p:inputTextarea id="mdslQuery" rows="6" cols="180" autoResize="false" widgetVar="mdslQuery"
                                                             completeMethod="#{autoCompleteController.completeArea}" queryDelay="200" minQueryLength="4"/>-->
                                        <p:inputTextarea id="mdslQuery" rows="6" cols="180" autoResize="false" widgetVar="mdslQuery" var="mdslQuery"
                                                         value="#{sessionMDSLRRequestController.sessionRequest}"/>
                                        <h:panelGroup>
                                            <p:commandButton id="execQuery" widgetVar="execQuery" type="button" value="Execute request" title="Execute"
                                                             icon="icon-play-circle icon-large" style="width:150px"/><br/>
                                            <p:commandButton type="button" value="Load request" title="Load" icon="icon-upload icon-large" style="width:150px"
                                                             onclick="requestLoaderDialog.show()" update=":loadReqDirForm,:loadRequestDetail"/><br/>
                                            <p:commandButton type="commandButton" value="Save request" title="Save" icon="icon-download icon-large" style="width:150px"
                                                             onclick="requestSaveDialog.show()" actionListener="#{mdslrRequestController.clear}"
                                                             update=":saveReqDirForm,:saveRequestDetail"/>
                                        </h:panelGroup>
                                    </h:panelGrid>
                                </h:form>
                            </p:tab>
                        </p:tabView>
                    </p:layoutUnit>
                    <p:layoutUnit position="center" resizable="false">
                        <div id="mappyCanvas" oncontextmenu="return false;"/>
                    </p:layoutUnit>
                </p:layout>
            </p:layoutUnit>
        </p:layout>

        <p:dialog header="Load request" widgetVar="requestLoaderDialog"
                  width="1000" height="600" showEffect="fade" hideEffect="explode" resizable="false">
                <p:layout style="min-width:980px;min-height:590px;">
                    <p:layoutUnit position="west" size="240" header="NAVIGATION" resizable="false" style="border: 0px">
                        <h:form id="loadReqDirForm">
                            <p:tree value="#{mdslRegistryController.root}" var="node" animate="true" style="width: 230px; border: 0px"
                                    selectionMode="single" selection="#{mdslRegistryController.selectedDirectoryOrRequestNode}" >
                                <p:ajax event="select" update=":loadRequestDetail"/>
                                <p:treeNode type="Folder" expandedIcon="icon-folder-open" collapsedIcon="icon-folder-close">
                                    <h:outputText value="#{node.name}"/>
                                </p:treeNode>
                                <p:treeNode type="Request" icon="icon-file">
                                    <h:outputText value="#{node.name}" />
                                </p:treeNode>
                                <p:treeNode type="Template" icon="icon-file">
                                    <h:outputText value="#{node.name}" />
                                </p:treeNode>
                            </p:tree>
                        </h:form>
                    </p:layoutUnit>
                    <p:layoutUnit position="center" resizable="false" header="REQUEST DETAILS" style="border: 0px">
                        <h:panelGroup id="loadRequestDetail">
                            <br/>
                            <h:outputText value="Choose a target from navigation pane." rendered="#{mdslRegistryController.selectedRequestNode==null}"/>
                            <h:form rendered="#{mdslRegistryController.selectedRequestNode!=null}">
                                <br/>
                                <p:fieldset legend="Request" style="width: 700px; height: 155px">
                                    <p:scrollPanel style="width: 700px; height: 120px; border: 0px">
<pre>
#{mdslRegistryController.selectedRequestReq}
</pre>
                                    </p:scrollPanel>
                                </p:fieldset>
                                <br/>
                                <p:fieldset legend="Description" style="width: 700px; height: 155px">
                                    <p:scrollPanel style="width: 700px; height: 120px; border: 0px">
                                        <h:outputText value="#{mdslRegistryController.selectedRequestDesc}"/>
                                    </p:scrollPanel>
                                </p:fieldset>
                                <br/>
                                <p:separator/>
                                <br/>
                                <p:commandButton value="Use that one !" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"
                                                 oncomplete="requestLoaderDialog.hide();"
                                                 update=":mappingToolsView:mapToolsQueryForm:mdslQuery"
                                                 actionListener="#{sessionMDSLRRequestController.loadSelectedRequest}"/>
                            </h:form>
                        </h:panelGroup>
                     </p:layoutUnit>
                </p:layout>
        </p:dialog>

        <p:dialog header="Save request" widgetVar="requestSaveDialog"
                  width="1000" height="600" showEffect="fade" hideEffect="explode" resizable="false">
            <p:layout style="min-width:980px;min-height:590px;">
                <p:layoutUnit position="west" size="240" header="NAVIGATION" resizable="false" style="border: 0px">
                    <h:form id="saveReqDirForm">
                        <p:tree value="#{mdslRegistryController.root}" var="node" animate="true" style="width: 230px; border: 0px"
                                selectionMode="single" selection="#{mdslRegistryController.selectedDirectoryOrRequestNode}" >
                            <p:ajax event="select" update=":saveRequestDetail" listener="#{mdslRegistryController.warnOnReadyToEraseExistingRequest}" />
                            <p:treeNode type="Folder" expandedIcon="icon-folder-open" collapsedIcon="icon-folder-close">
                                <h:outputText value="#{node.name}"/>
                            </p:treeNode>
                            <p:treeNode type="Request" icon="icon-file">
                                <h:outputText value="#{node.name}" />
                            </p:treeNode>
                            <p:treeNode type="Template" icon="icon-file">
                                <h:outputText value="#{node.name}" />
                            </p:treeNode>
                        </p:tree>
                    </h:form>
                </p:layoutUnit>
                <p:layoutUnit position="center" resizable="false" header="REQUEST DETAILS" style="border: 0px">
                    <h:panelGroup id="saveRequestDetail">
                        <br/>
                        <h:form>
                            <h:panelGrid id="requestNewGrid" columns="2" cellpadding="5"
                                         styleClass="ui-widget-content grid" style="border: 0px">
                                <p:outputLabel value="Target directory : " styleClass="inputTitle"/>
                                <h:panelGroup>
                                    <h:outputText id="targetDirectory1" value="#{mdslrRequestController.rootDirectory.fullPath}" rendered="#{mdslrRequestController.rootDirectory!=null}"/>
                                    <h:outputText id="targetDirectory2" value="Choose a target from navigation pane." rendered="#{mdslrRequestController.rootDirectory==null}"/>
                                </h:panelGroup>

                                <p:outputLabel for="name" value="Name : " styleClass="inputTitle" rendered="#{mdslrRequestController.rootDirectory!=null}"/>
                                <p:inputText id="name" label="Name" required="true"
                                             cols="80" value="#{mdslrRequestController.name}" rendered="#{mdslrRequestController.rootDirectory!=null}"/>

                                <p:outputLabel for="request" value="Request : " styleClass="inputTitle" rendered="#{mdslrRequestController.rootDirectory!=null}"/>
                                <p:inputTextarea id="request" label="Request" required="true"
                                                 rows="10" cols="80" value="#{mdslrRequestController.request}" rendered="#{mdslrRequestController.rootDirectory!=null}"/>

                                <p:outputLabel for="description" value="Description : " styleClass="inputTitle" rendered="#{mdslrRequestController.rootDirectory!=null}"/>
                                <p:inputTextarea id="description" label="Description" required="true"
                                                 rows="10" cols="80" value="#{mdslrRequestController.description}" rendered="#{mdslrRequestController.rootDirectory!=null}"/>
                            </h:panelGrid>
                            <h:inputHidden id="id" value="#{mdslrRequestController.id}" rendered="#{mdslrRequestController.rootDirectory!=null}"/>

                            <p:separator/>
                            <br/>
                            <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true" />
                            <p:commandButton value="Save" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"
                                             oncomplete="requestSaveDialog.hide();" actionListener="#{mdslrRequestController.save}"/>
                        </h:form>
                    </h:panelGroup>
                </p:layoutUnit>
            </p:layout>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>